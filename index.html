<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Yusuf Runner - BÃ¶lÃ¼m 1</title>
  <style>
    :root { color-scheme: dark; }
    html, body { margin:0; height:100%; background:#0b0f14; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #wrap { height:100%; display:flex; align-items:center; justify-content:center; padding:12px; }
    canvas{
      width:min(92vw, 420px);
      height:calc(min(92vw, 420px) * 1.78);
      background:#000;
      border:2px solid rgba(255,255,255,.12);
      border-radius:14px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      touch-action: manipulation;
    }

    #overlay{
      position:fixed; inset:0; display:none;
      background:rgba(0,0,0,.60);
      align-items:center; justify-content:center;
      padding:18px;
    }
    #card{
      width:min(520px, 92vw);
      background:#111826;
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      padding:16px;
      box-shadow:0 16px 50px rgba(0,0,0,.5);
    }
    #qtitle{ margin:0 0 8px; font-size:16px; opacity:.9; }
    #qtext{ margin:0 0 12px; font-size:18px; line-height:1.25; }
    .opt{
      width:100%;
      text-align:left;
      padding:12px;
      margin:8px 0;
      background:#0e1522;
      border:1px solid rgba(255,255,255,.14);
      border-radius:12px;
      color:#eaf1ff;
      font-size:16px;
    }
    #hint{ margin:10px 2px 0; font-size:13px; opacity:.75; }

    #toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:18px; padding:10px 14px;
      background:rgba(17,24,38,.92);
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px; display:none;
      font-size:14px;
      max-width:92vw;
      text-align:center;
    }
  </style>
</head>
<body>
<div id="wrap">
  <canvas id="c" width="240" height="426"></canvas>
</div>

<div id="overlay">
  <div id="card">
    <p id="qtitle">Quiz</p>
    <p id="qtext">Soru</p>
    <button class="opt" data-i="0"></button>
    <button class="opt" data-i="1"></button>
    <button class="opt" data-i="2"></button>
    <button class="opt" data-i="3"></button>
    <p id="hint">3 soru var. Bitince final ekranÄ±na geÃ§eceksin.</p>
  </div>
</div>

<div id="toast"></div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  ctx.imageSmoothingEnabled = false;

  const overlay = document.getElementById('overlay');
  const qtext = document.getElementById('qtext');
  const optBtns = Array.from(document.querySelectorAll('.opt'));
  const toast = document.getElementById('toast');

  const W = canvas.width, H = canvas.height;

  // ---------- Assets (SENÄ°N DOSYA ADLARIN) ----------
  const bgImg = new Image();     bgImg.src = "assets/bg_loop.png";
  const finalImg = new Image();  finalImg.src = "assets/final.png";
  const paperImg = new Image();  paperImg.src = "assets/paper.png";
  const booksImg1 = new Image(); booksImg1.src = "assets/books2.png";
  const booksImg2 = new Image(); booksImg2.src = "assets/books3.png";
  const shieldImg = new Image(); shieldImg.src = "assets/shield.png";

  function ready(img){ return img && img.complete && img.naturalWidth > 0; }

  // ---------- Game constants ----------
  const GROUND_Y = 360;
  const GRAV = 0.55;
  const JUMP_V = -10.2;

  // ---------- State ----------
  let state = "start"; // start | run | quiz | final | gameover
  let t = 0;
  let speed = 2.8;

  // background loop offset
  let bgX = 0;

  const player = {
    x: 44, y: GROUND_Y - 18,
    w: 14, h: 18,
    vy: 0, onGround: true,
    shield: false,
    invul: 0
  };

  let obstacles = [];
  let nextSpawn = 40;

  let shieldDrops = [];
  let nextShield = 200;

  let elapsed = 0;

  const LEVEL_SECONDS = 45;

  // Quiz
  const quizzes = [
    { q:"Yusufâ€™un bu bÃ¶lÃ¼mde hedefi ne?", options:["KoÅŸmak","Ãœniversiteye ulaÅŸmak","BalÄ±k tutmak","Uyumak"], correct:1 },
    { q:"BÃ¶lÃ¼m 1 nerede geÃ§iyor?", options:["KadÄ±kÃ¶y","BeÅŸiktaÅŸ","Ankara","Ä°zmir"], correct:1 },
    { q:"Finalde ne oluyor?", options:["Kaybediyor","Mezun oluyor","UÃ§uyor","Kayboluyor"], correct:1 },
  ];
  let quizIndex = 0;

  // ---------- Utils ----------
  function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }
  function rand(a,b){ return a + Math.random()*(b-a); }
  function rectHit(a,b){ return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y; }

  function showToast(msg){
    toast.textContent = msg;
    toast.style.display = 'block';
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.style.display='none', 900);
  }

  // ---------- Controls ----------
  function jump(){
    if(state === "start"){ startGame(); return; }
    if(state === "gameover"){ startGame(); return; }
    if(state !== "run") return;

    if(player.onGround){
      player.vy = JUMP_V;
      player.onGround = false;
    }
  }
  canvas.addEventListener('pointerdown', (e)=>{ e.preventDefault(); jump(); });
  document.addEventListener('touchmove', e => { if(state==="run") e.preventDefault(); }, {passive:false});

  // ---------- Background: FULL HEIGHT + LOOP ----------
  function drawLoopBackgroundCover(img, parallaxSpeed){
    if(!ready(img)) {
      ctx.fillStyle = "#000";
      ctx.fillRect(0,0,W,H);
      return;
    }

    // tavan-tabana deÄŸsin
    const scale = H / img.height;
    const drawW = img.width * scale;
    const drawH = H;

    bgX -= parallaxSpeed;
    bgX = bgX % drawW;
    if(bgX > 0) bgX -= drawW;

    // yan yana bas
    for(let x = bgX; x < W + drawW; x += drawW){
      ctx.drawImage(img, x, 0, drawW, drawH);
    }
  }

  // ---------- Drawing ----------
  function drawHUD(){
    ctx.fillStyle = "rgba(234,241,255,.92)";
    ctx.font = "10px system-ui";
    ctx.fillText("Dokun = ZÄ±pla", 10, 16);

    ctx.fillStyle = "rgba(234,241,255,.85)";
    ctx.fillText("BÃ¶lÃ¼m 1 â€” BeÅŸiktaÅŸ", 10, 34);

    if(state === "run"){
      ctx.fillStyle = "rgba(234,241,255,.80)";
      ctx.fillText("SÃ¼re: " + Math.max(0, Math.ceil(LEVEL_SECONDS - elapsed)) + "sn", 10, 50);
      ctx.fillText("Kalkan: " + (player.shield ? "VAR" : "YOK"), 10, 64);
    }
  }

  function drawGroundLine(){
    ctx.fillStyle = "rgba(0,0,0,.22)";
    ctx.fillRect(0, GROUND_Y, W, 2);
  }

  function drawPlayer(){
    // Placeholder karakter (sabah sprite takacaÄŸÄ±z)
    if(player.invul > 0 && Math.floor(t/6)%2===0) return;

    ctx.fillStyle = "#eaf1ff";
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = "#0b0f14";
    ctx.fillRect(player.x+3, player.y+5, 2, 2);
    ctx.fillRect(player.x+9, player.y+5, 2, 2);

    if(player.shield){
      ctx.strokeStyle = "rgba(120,255,210,.9)";
      ctx.lineWidth = 2;
      ctx.strokeRect(player.x-2, player.y-2, player.w+4, player.h+4);
      ctx.lineWidth = 1;
    }
  }

  function drawObstacle(o){
    if(o.img && ready(o.img)){
      ctx.drawImage(o.img, o.x, o.y, o.w, o.h);
    } else {
      ctx.fillStyle = "#ff5b7a";
      ctx.fillRect(o.x, o.y, o.w, o.h);
    }
  }

  function drawShieldDrop(s){
    if(ready(shieldImg)){
      ctx.drawImage(shieldImg, s.x, s.y, s.w, s.h);
    } else {
      ctx.fillStyle="#5bd6ff";
      ctx.fillRect(s.x, s.y, s.w, s.h);
    }
  }

  function drawFinal(){
    if(ready(finalImg)){
      const scale = H / finalImg.height;
      const drawW = finalImg.width * scale;
      const drawH = H;
      const x = (W - drawW) / 2;
      ctx.drawImage(finalImg, x, 0, drawW, drawH);
    } else {
      ctx.fillStyle="#000";
      ctx.fillRect(0,0,W,H);
      ctx.fillStyle="#fff";
      ctx.font="16px system-ui";
      ctx.fillText("FINAL YÃœKLENÄ°YOR...", 40, 210);
    }

    ctx.fillStyle = "rgba(0,0,0,.35)";
    ctx.fillRect(0, 0, W, 42);
    ctx.fillStyle="#eaf1ff";
    ctx.font="12px system-ui";
    ctx.fillText("BÃ¶lÃ¼m 1 TamamlandÄ±!", 10, 18);
    ctx.font="10px system-ui";
    ctx.fillText("Dokun â†’ Devam", 10, 34);
  }

  function drawStart(){
    drawLoopBackgroundCover(bgImg, 0);
    drawGroundLine();

    ctx.fillStyle="rgba(0,0,0,.35)";
    ctx.fillRect(0, 0, W, H);

    ctx.fillStyle="#eaf1ff";
    ctx.font="16px system-ui";
    ctx.fillText("Dokun ve BaÅŸla", 55, 200);
    ctx.font="11px system-ui";
    ctx.fillStyle="rgba(234,241,255,.8)";
    ctx.fillText("Engeller: KaÄŸÄ±t + Kitap", 56, 224);
    ctx.fillText("Kalkan: 1 Ã§arpma affeder", 44, 242);
  }

  function drawGameOver(){
    ctx.fillStyle="rgba(0,0,0,.55)";
    ctx.fillRect(0,0,W,H);
    ctx.fillStyle="#eaf1ff";
    ctx.font="16px system-ui";
    ctx.fillText("Ã‡ARPTIN!", 86, 190);
    ctx.font="11px system-ui";
    ctx.fillText("Dokun â†’ Tekrar", 72, 214);
  }

  // ---------- Spawning ----------
  function spawnObstacle(){
    const r = Math.random();

    if(r < 0.45){
      // uÃ§an kaÄŸÄ±t
      const w = 24, h = 18;
      obstacles.push({
        img: paperImg,
        x: W + 20,
        y: (GROUND_Y - 100 - Math.random()*40) | 0,
        w, h
      });
    } else {
      // kitap (2 varyasyon)
      const img = Math.random() < 0.5 ? booksImg1 : booksImg2;
      const w = 28;
      const h = (img === booksImg1) ? 18 : 26;

      obstacles.push({
        img,
        x: W + 20,
        y: GROUND_Y - h,
        w, h
      });
    }
  }

  function spawnShield(){
    const size = 22;
    shieldDrops.push({
      x: W + 20,
      y: (GROUND_Y - 95 - rand(0,25)) | 0,
      w: size,
      h: size
    });
  }

  // ---------- Quiz ----------
  function openQuiz(){
    state = "quiz";
    overlay.style.display = "flex";

    const q = quizzes[quizIndex];
    qtext.textContent = q.q;
    optBtns.forEach((btn,i)=>{
      btn.disabled = false;
      btn.textContent = (["A) ","B) ","C) ","D) "][i]) + q.options[i];
    });
  }

  function closeQuiz(){
    overlay.style.display = "none";
  }

  optBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const picked = Number(btn.dataset.i);
      const q = quizzes[quizIndex];

      optBtns.forEach(b=> b.disabled = true);

      showToast(picked === q.correct ? "âœ… DoÄŸru" : "âŒ YanlÄ±ÅŸ");
      quizIndex++;

      setTimeout(()=>{
        if(quizIndex >= quizzes.length){
          closeQuiz();
          state = "final";
        } else {
          const nq = quizzes[quizIndex];
          qtext.textContent = nq.q;
          optBtns.forEach((b,i)=>{
            b.disabled = false;
            b.textContent = (["A) ","B) ","C) ","D) "][i]) + nq.options[i];
          });
        }
      }, 450);
    });
  });

  // ---------- Game flow ----------
  function startGame(){
    state = "run";
    t = 0;
    elapsed = 0;
    speed = 2.8;
    bgX = 0;

    obstacles = [];
    shieldDrops = [];

    player.y = GROUND_Y - player.h;
    player.vy = 0;
    player.onGround = true;
    player.shield = false;
    player.invul = 0;

    nextSpawn = 40;
    nextShield = 180 + (Math.random()*160)|0;

    quizIndex = 0;
    closeQuiz();
    showToast("ðŸ BaÅŸla!");
  }

  function handleFinalTouch(){
    // ÅŸimdilik baÅŸa dÃ¶n (bÃ¶lÃ¼m2 gelince deÄŸiÅŸtiririz)
    state = "start";
  }
  canvas.addEventListener('pointerdown', ()=>{
    if(state === "final") handleFinalTouch();
  });

  // ---------- Main loop ----------
  function step(){
    requestAnimationFrame(step);
    t++;

    if(state === "start"){
      drawStart();
      return;
    }

    if(state === "final"){
      drawFinal();
      return;
    }

    // RUN / QUIZ / GAMEOVER arka plan
    drawLoopBackgroundCover(bgImg, (state==="run" ? speed*0.35 : 0));
    drawGroundLine();
    drawHUD();

    if(state === "quiz"){
      drawPlayer();
      obstacles.forEach(drawObstacle);
      shieldDrops.forEach(drawShieldDrop);
      return;
    }

    if(state === "gameover"){
      drawPlayer();
      obstacles.forEach(drawObstacle);
      shieldDrops.forEach(drawShieldDrop);
      drawGameOver();
      return;
    }

    // ---------- RUN ----------
    elapsed += 1/60;

    if(elapsed >= LEVEL_SECONDS){
      openQuiz();
      return;
    }

    // fizik
    player.vy += GRAV;
    player.y += player.vy;
    if(player.y >= GROUND_Y - player.h){
      player.y = GROUND_Y - player.h;
      player.vy = 0;
      player.onGround = true;
    }

    // engel spawn
    nextSpawn--;
    if(nextSpawn <= 0){
      spawnObstacle();
      const base = rand(45, 85);
      nextSpawn = clamp((base / (1 + (speed-2.8)*0.25))|0, 28, 95);
    }

    // kalkan spawn
    nextShield--;
    if(nextShield <= 0){
      spawnShield();
      nextShield = 200 + (Math.random()*220)|0;
    }

    // hafif hÄ±z artÄ±ÅŸÄ±
    speed += 0.0009;

    const pRect = { x: player.x, y: player.y, w: player.w, h: player.h };

    // engeller
    for(let i=obstacles.length-1; i>=0; i--){
      const o = obstacles[i];
      o.x -= speed;
      drawObstacle(o);

      if(o.x + o.w < -30) { obstacles.splice(i,1); continue; }

      if(rectHit(pRect, o)){
        if(player.shield){
          player.shield = false;
          obstacles.splice(i,1);
          showToast("ðŸ›¡ Kalkan kÄ±rÄ±ldÄ±!");
        } else {
          state = "gameover";
          showToast("ðŸ’¥ Ã‡arptÄ±n");
        }
      }
    }

    // kalkanlar
    for(let i=shieldDrops.length-1; i>=0; i--){
      const s = shieldDrops[i];
      s.x -= speed * 0.75;
      drawShieldDrop(s);

      if(s.x + s.w < -30) { shieldDrops.splice(i,1); continue; }

      if(rectHit(pRect, s)){
        player.shield = true;
        shieldDrops.splice(i,1);
        showToast("ðŸ›¡ Kalkan aldÄ±n!");
      }
    }

    drawPlayer();
  }

  step();
})();
</script>
</body>
</html>


