<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Yusuf Runner ‚Äî B√∂l√ºm 1</title>
  <style>
    :root { color-scheme: dark; }
    html, body { margin:0; height:100%; background:#0b0f14; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #wrap { height:100%; display:flex; align-items:center; justify-content:center; padding:12px; }
    canvas{
      width:min(92vw, 420px);
      height:calc(min(92vw, 420px) * 1.78);
      border:2px solid rgba(255,255,255,.14);
      border-radius:14px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      touch-action: manipulation;
      background:#0b0f14;
    }
    #overlay{
      position:fixed; inset:0; display:none;
      background:rgba(0,0,0,.55);
      align-items:center; justify-content:center;
      padding:18px;
    }
    #card{
      width:min(520px, 92vw);
      background:#111826;
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      padding:16px;
      box-shadow:0 16px 50px rgba(0,0,0,.5);
    }
    #qtitle{ margin:0 0 8px; font-size:14px; opacity:.85; }
    #qtext{ margin:0 0 12px; font-size:18px; line-height:1.25; }
    .opt{
      width:100%;
      text-align:left;
      padding:12px 12px;
      margin:8px 0;
      background:#0e1522;
      border:1px solid rgba(255,255,255,.14);
      border-radius:12px;
      color:#eaf1ff;
      font-size:16px;
    }
    .opt:active{ transform:scale(.99); }
    #toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:18px; padding:10px 14px;
      background:rgba(17,24,38,.92);
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px; display:none;
      font-size:14px;
    }
    #tip{
      position:fixed; top:14px; left:50%; transform:translateX(-50%);
      color:rgba(234,241,255,.85);
      font-size:13px; padding:6px 10px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px;
    }
  </style>
</head>
<body>
<div id="wrap">
  <canvas id="c" width="240" height="426"></canvas>
</div>

<div id="overlay">
  <div id="card">
    <p id="qtitle">B√∂l√ºm Arasƒ± Quiz</p>
    <p id="qtext">Soru</p>
    <button class="opt" data-i="0"></button>
    <button class="opt" data-i="1"></button>
    <button class="opt" data-i="2"></button>
    <button class="opt" data-i="3"></button>
  </div>
</div>

<div id="toast"></div>
<div id="tip">Dokun = Zƒ±pla</div>

<script>
(() => {
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");
  ctx.imageSmoothingEnabled = false;

  const overlay = document.getElementById("overlay");
  const qtext = document.getElementById("qtext");
  const optBtns = Array.from(document.querySelectorAll(".opt"));
  const toast = document.getElementById("toast");

  const W = canvas.width, H = canvas.height;
  const GROUND_Y = 350;

  // --- ASSET PATHS (repo'da /assets i√ßine koy)
  const ASSETS = {
    bg: "assets/bg_loop.png",
    final: "assets/final.png",
    paper: "assets/paper.png",
    books2: "assets/books2.png",
    books3: "assets/books3.png",
    shield: "assets/shield.png",
  };

  function loadImage(src){
    return new Promise((res, rej) => {
      const im = new Image();
      im.onload = () => res(im);
      im.onerror = rej;
      im.src = src;
    });
  }

  function showToast(msg){
    toast.textContent = msg;
    toast.style.display = "block";
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.style.display="none", 1100);
  }

  // --- Quiz (≈üimdilik B√∂l√ºm 1 i√ßin 1 soru; istersen deƒüi≈ütir)
  const quiz = {
    q: "B√∂l√ºm 1 tamam! Sƒ±radaki hedef ne?",
    options: ["Okul", "Sahil", "Market", "Uzay"],
    correct: 1
  };

  let running = false;
  let pausedForQuiz = false;
  let showingFinal = false;

  let t = 0;
  let timeLeft = 45.0; // b√∂l√ºm s√ºresi (sn)
  let speed = 2.25;

  const player = {
    x: 40, y: GROUND_Y - 18,
    w: 14, h: 18,
    vy: 0,
    onGround: true,
    hasShield: false,
  };

  // world
  let bgX = 0;

  let obstacles = [];
  let shields = [];
  let spawnTimer = 0;
  let shieldTimer = 6.5; // ilk kalkan biraz ge√ß gelsin

  // images
  let IM = {};

  function rectHit(a,b){
    return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y;
  }

  function reset(){
    running = true;
    pausedForQuiz = false;
    showingFinal = false;
    t = 0;
    timeLeft = 45.0;
    speed = 2.25;
    bgX = 0;

    player.y = GROUND_Y - player.h;
    player.vy = 0;
    player.onGround = true;
    player.hasShield = false;

    obstacles = [];
    shields = [];
    spawnTimer = 0;
    shieldTimer = 6.5;
  }

  function jump(){
    if(!running){ reset(); return; }
    if(pausedForQuiz || showingFinal) return;
    if(player.onGround){
      player.vy = -10.2;
      player.onGround = false;
    }
  }

  canvas.addEventListener("pointerdown", (e)=>{ e.preventDefault(); jump(); });
  document.addEventListener("touchmove", e => { if(running) e.preventDefault(); }, {passive:false});

  function openQuiz(){
    pausedForQuiz = true;
    overlay.style.display = "flex";
    qtext.textContent = quiz.q;
    optBtns.forEach((btn,i)=>{
      btn.disabled = false;
      btn.style.opacity = "1";
      btn.textContent = (["A) ","B) ","C) ","D) "][i]) + quiz.options[i];
    });
  }

  function closeQuiz(){
    overlay.style.display = "none";
    pausedForQuiz = false;
    // quiz bitti -> final g√∂ster
    showingFinal = true;
    finalTimer = 4.0;
  }

  optBtns.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const picked = Number(btn.dataset.i);
      optBtns.forEach(b=> b.disabled = true);

      if(picked === quiz.correct){
        showToast("‚úÖ Doƒüru!");
      }else{
        showToast("‚ùå Yanlƒ±≈ü!");
      }
      setTimeout(closeQuiz, 450);
    });
  });

  let finalTimer = 0;

  function drawPlayer(){
    // karakter gelene kadar placeholder
    ctx.fillStyle = "#eaf1ff";
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = "#0b0f14";
    ctx.fillRect(player.x+3, player.y+5, 2, 2);
    ctx.fillRect(player.x+9, player.y+5, 2, 2);

    if(player.hasShield){
      ctx.strokeStyle = "rgba(120,255,210,.75)";
      ctx.lineWidth = 2;
      ctx.strokeRect(player.x-2, player.y-2, player.w+4, player.h+4);
      ctx.lineWidth = 1;
    }
  }

  function drawHUD(){
    ctx.fillStyle = "rgba(234,241,255,.9)";
    ctx.font = "10px system-ui";
    ctx.fillText("B√∂l√ºm 1 ‚Äî Be≈üikta≈ü", 10, 16);
    ctx.fillStyle = "rgba(234,241,255,.75)";
    ctx.fillText("S√ºre: " + Math.ceil(timeLeft) + "s", 10, 32);
    ctx.fillText("Kalkan: " + (player.hasShield ? "Var" : "Yok"), 10, 46);
  }

  function spawnObstacle(){
    // books (zemin) veya paper (u√ßan)
    const r = Math.random();
    if(r < 0.65){
      const use3 = Math.random() < 0.45;
      const img = use3 ? IM.books3 : IM.books2;
      const scale = 1.0;
      const w = img.width * scale;
      const h = img.height * scale;
      obstacles.push({
        type:"books",
        img, scale,
        x: W + 10,
        y: GROUND_Y - h,
        w, h
      });
    }else{
      const img = IM.paper;
      const scale = 1.0;
      const w = img.width * scale;
      const h = img.height * scale;
      const y = 210 + Math.random()*70; // havada
      obstacles.push({
        type:"paper",
        img, scale,
        x: W + 10,
        y: y,
        w, h
      });
    }
  }

  function spawnShield(){
    const img = IM.shield;
    const scale = 0.9;
    const w = img.width * scale;
    const h = img.height * scale;
    const y = 230 + Math.random()*70;
    shields.push({ x: W + 10, y, w, h, img, scale });
  }

  function drawImage(im, x, y, scale=1){
    ctx.drawImage(im, x|0, y|0, (im.width*scale)|0, (im.height*scale)|0);
  }

  function loop(){
    requestAnimationFrame(loop);
    t++;

    // clear
    ctx.clearRect(0,0,W,H);

    if(!running){
      // start screen
      ctx.fillStyle = "#0b0f14";
      ctx.fillRect(0,0,W,H);
      ctx.fillStyle = "rgba(234,241,255,.95)";
      ctx.font = "16px system-ui";
      ctx.fillText("Dokun ve Ba≈üla", 55, 210);
      ctx.font = "11px system-ui";
      ctx.fillStyle = "rgba(234,241,255,.7)";
      ctx.fillText("Engeller: Kaƒüƒ±t & Kitap", 56, 235);
      ctx.fillText("Kalkan al, 1 √ßarpma affeder", 36, 252);
      return;
    }

    // FINAL SCREEN
    if(showingFinal){
      drawImage(IM.final, 0, 0, 1);
      // basit kutlama yazƒ±sƒ±
      ctx.fillStyle = "rgba(0,0,0,.35)";
      ctx.fillRect(18, 360, 204, 40);
      ctx.fillStyle = "rgba(234,241,255,.95)";
      ctx.font = "14px system-ui";
      ctx.fillText("B√∂l√ºm 1 Tamam!", 58, 385);

      finalTimer -= 1/60;
      if(finalTimer <= 0){
        // ≈üimdilik yeniden ba≈ülat (b√∂l√ºm 2 gelince burasƒ± deƒüi≈üecek)
        running = false;
        showingFinal = false;
        showToast("üéâ Bitti! (B√∂l√ºm 2'yi ekleyince devam edeceƒüiz)");
      }
      return;
    }

    // pause for quiz
    if(pausedForQuiz){
      // arka plan + son kareyi tutmak i√ßin basit √ßiz
      drawImage(IM.bg, bgX, 0, 1);
      drawImage(IM.bg, bgX + 480, 0, 1);
      // zemin bandƒ±
      ctx.fillStyle = "rgba(0,0,0,.25)";
      ctx.fillRect(0, GROUND_Y, W, H-GROUND_Y);
      drawHUD();
      drawPlayer();
      obstacles.forEach(o => drawImage(o.img, o.x, o.y, o.scale));
      shields.forEach(s => drawImage(s.img, s.x, s.y, s.scale));
      return;
    }

    // dt
    const dt = 1/60;

    // time
    timeLeft -= dt;
    if(timeLeft <= 0){
      timeLeft = 0;
      openQuiz();
      return;
    }

    // background scroll (480 geni≈ülik)
    bgX -= speed*0.35;
    if(bgX <= -480) bgX += 480;
    drawImage(IM.bg, bgX, 0, 1);
    drawImage(IM.bg, bgX + 480, 0, 1);

    // ground overlay
    ctx.fillStyle = "rgba(0,0,0,.18)";
    ctx.fillRect(0, GROUND_Y, W, H-GROUND_Y);

    // player physics
    player.vy += 0.55;
    player.y += player.vy;
    if(player.y >= GROUND_Y - player.h){
      player.y = GROUND_Y - player.h;
      player.vy = 0;
      player.onGround = true;
    }

    // spawn obstacles
    spawnTimer -= dt;
    if(spawnTimer <= 0){
      spawnObstacle();
      // spawn aralƒ±ƒüƒ± (hƒ±zla biraz kƒ±salƒ±r)
      const base = 1.15;
      const varr = 0.65;
      spawnTimer = (base + Math.random()*varr) / (1 + (speed-2.25)*0.12);
    }

    // spawn shield
    shieldTimer -= dt;
    if(shieldTimer <= 0){
      spawnShield();
      shieldTimer = 10 + Math.random()*7; // 10-17 sn
    }

    const pRect = { x: player.x, y: player.y, w: player.w, h: player.h };

    // move/draw obstacles
    for(let i=obstacles.length-1;i>=0;i--){
      const o = obstacles[i];
      o.x -= speed;

      drawImage(o.img, o.x, o.y, o.scale);

      if(o.x + o.w < -40) obstacles.splice(i,1);

      if(rectHit(pRect, o)){
        if(player.hasShield){
          player.hasShield = false;
          obstacles.splice(i,1);
          showToast("üõ°Ô∏è Kalkan √ßarpmayƒ± engelledi!");
        }else{
          // game over
          running = false;
          showToast("üí• √áarptƒ±n! Dokun ve tekrar ba≈üla");
          return;
        }
      }
    }

    // move/draw shields
    for(let i=shields.length-1;i>=0;i--){
      const s = shields[i];
      s.x -= speed;

      drawImage(s.img, s.x, s.y, s.scale);

      if(s.x + s.w < -40) shields.splice(i,1);

      if(rectHit(pRect, s)){
        player.hasShield = true;
        shields.splice(i,1);
        showToast("üõ°Ô∏è Kalkan aldƒ±n!");
      }
    }

    drawPlayer();
    drawHUD();
  }

  async function boot(){
    try{
      const [bg, final, paper, books2, books3, shield] = await Promise.all([
        loadImage(ASSETS.bg),
        loadImage(ASSETS.final),
        loadImage(ASSETS.paper),
        loadImage(ASSETS.books2),
        loadImage(ASSETS.books3),
        loadImage(ASSETS.shield),
      ]);
      IM = { bg, final, paper, books2, books3, shield };
      // bg ve final zaten 480x250 -> canvas 240x426'da √ºstte oturtmak i√ßin √∂l√ßek 0.5
      // Biz 480x250'yi canvas'a 240x125 olarak √ßizmek istemiyoruz.
      // Bu y√ºzden: bg ve final'i kodda 240x426 i√ßin otomatik √∂l√ßekleyeceƒüiz.
      // Kolay yol: bg/final dosyalarƒ±nƒ± 240x426 yap. ≈ûimdilik burada 480x250'yi canvas'a sƒ±ƒüdƒ±rƒ±yoruz:
      // -> drawImage fonksiyonunda 1 √∂l√ßek ile 480 px geni≈ülik sƒ±ƒümaz.
      // √á√∂z√ºm: bg/final'i y√ºkler y√ºklemez 240x426'ya √∂l√ßekle.
      const makeFit = (im) => {
        const off = document.createElement("canvas");
        off.width = 240; off.height = 426;
        const ictx = off.getContext("2d");
        ictx.imageSmoothingEnabled = false;
        // 480x250'yi yatayda sƒ±ƒüdƒ±rmak i√ßin 0.5 √∂l√ßek + yukarƒ± hizala
        ictx.drawImage(im, 0, 0, 240, 125);
        // alt kƒ±smƒ± basit g√∂ky√ºz√º/zeminle doldur
        // (istersen senin 240x426 background ile deƒüi≈ütiririz)
        ictx.drawImage(im, 0, 0, 240, 125);
        // stretch kalan kƒ±smƒ± aynƒ± g√∂r√ºnt√ºden biraz uzat (pratik √ß√∂z√ºm)
        ictx.drawImage(im, 0, 90, 240, 336);
        const out = new Image();
        out.src = off.toDataURL("image/png");
        return out;
      };

      IM.bg = makeFit(bg);
      IM.final = makeFit(final);

      // Start at idle screen
      running = false;
      loop();
    }catch(e){
      console.error(e);
      alert("Asset y√ºklenemedi. assets klas√∂r√º ve dosya adlarƒ± doƒüru mu?");
    }
  }

  boot();
})();
</script>
</body>
</html>

